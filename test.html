<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Booking Form - JT Chauffeur</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div class="max-w-2xl w-full bg-gray-800 rounded-lg shadow-2xl p-8">
      <h1 class="text-3xl font-bold mb-6 text-center">üöó Test Booking Form</h1>
      <p class="text-gray-400 text-center mb-8">
        Submit a test enquiry to trigger the quote workflow
      </p>

      <form id="testForm" class="space-y-4">
        <div>
          <label class="block text-sm font-semibold mb-2">Customer Name *</label>
          <input
            type="text"
            id="customerName"
            required
            class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            placeholder="John Smith"
          />
        </div>

        <div>
          <label class="block text-sm font-semibold mb-2">Phone Number (with country code) *</label>
          <input
            type="tel"
            id="customerPhone"
            required
            class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            placeholder="+447700123456"
          />
        </div>

        <div>
          <label class="block text-sm font-semibold mb-2">Email (optional)</label>
          <input
            type="email"
            id="customerEmail"
            class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            placeholder="john@example.com"
          />
        </div>

        <div>
          <label class="block text-sm font-semibold mb-2">Pickup Location *</label>
          <input
            type="text"
            id="pickupLocation"
            required
            class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            placeholder="Heathrow Airport"
          />
        </div>

        <div>
          <label class="block text-sm font-semibold mb-2">Dropoff Location *</label>
          <input
            type="text"
            id="dropoffLocation"
            required
            class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            placeholder="Central London"
          />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold mb-2">Pickup Date *</label>
            <input
              type="date"
              id="pickupDate"
              required
              class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            />
          </div>
          <div>
            <label class="block text-sm font-semibold mb-2">Pickup Time *</label>
            <input
              type="time"
              id="pickupTime"
              required
              class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            />
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold mb-2">Passengers *</label>
            <input
              type="number"
              id="passengers"
              required
              min="1"
              max="8"
              value="2"
              class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            />
          </div>
          <div>
            <label class="block text-sm font-semibold mb-2">Vehicle Type *</label>
            <select
              id="vehicleType"
              required
              class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            >
              <option value="Saloon">Saloon</option>
              <option value="MPV">MPV</option>
              <option value="Minibus">Minibus</option>
              <option value="Executive">Executive</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-2">Special Requests (optional)</label>
          <textarea
            id="specialRequests"
            rows="3"
            class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-2 focus:outline-none focus:border-yellow-500"
            placeholder="Child seat, extra luggage space, etc."
          ></textarea>
        </div>

        <button
          type="submit"
          class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-6 rounded transition-colors"
        >
          Submit Test Enquiry
        </button>
      </form>

      <div id="result" class="mt-6 hidden"></div>
    </div>

    <script>
      // Set default date to tomorrow
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('pickupDate').value = tomorrow.toISOString().split('T')[0];
      document.getElementById('pickupTime').value = '14:00';

      // Handle form submission
      document.getElementById('testForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<p class="text-yellow-500">‚è≥ Submitting enquiry...</p>';
        resultDiv.classList.remove('hidden');

        const formData = {
          customerName: document.getElementById('customerName').value,
          customerPhone: document.getElementById('customerPhone').value,
          customerEmail: document.getElementById('customerEmail').value || null,
          pickupLocation: document.getElementById('pickupLocation').value,
          dropoffLocation: document.getElementById('dropoffLocation').value,
          pickupDate: document.getElementById('pickupDate').value,
          pickupTime: document.getElementById('pickupTime').value,
          passengers: parseInt(document.getElementById('passengers').value),
          vehicleType: document.getElementById('vehicleType').value,
          specialRequests: document.getElementById('specialRequests').value || null,
          source: 'web',
        };

        try {
          const response = await fetch('https://jesus-travel-back.onrender.com/api/enquiries', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });

          const data = await response.json();

          if (response.ok && data.success) {
            resultDiv.innerHTML = `
              <div class="bg-green-900 border border-green-500 rounded p-4">
                <h3 class="text-xl font-bold text-green-300 mb-2">‚úÖ Enquiry Submitted!</h3>
                <p class="text-green-200 mb-2">Reference: <strong>${data.data.referenceNumber}</strong></p>
                <p class="text-green-200 mb-2">Customer: ${data.data.customerName}</p>
                <p class="text-green-200 mb-2">Phone: ${data.data.customerPhone}</p>
                <p class="text-sm text-green-300 mt-4">
                  ‚úÖ Pricing team (+447822027794) should receive WhatsApp notification<br>
                  ‚úÖ Check admin dashboard for the enquiry<br>
                  ‚úÖ Quote button should appear for this enquiry
                </p>
              </div>
            `;
            // Reset form
            document.getElementById('testForm').reset();
            document.getElementById('pickupDate').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('pickupTime').value = '14:00';
          } else {
            resultDiv.innerHTML = `
              <div class="bg-red-900 border border-red-500 rounded p-4">
                <h3 class="text-xl font-bold text-red-300 mb-2">‚ùå Error</h3>
                <p class="text-red-200">${data.error?.message || 'Failed to submit enquiry'}</p>
              </div>
            `;
          }
        } catch (error) {
          resultDiv.innerHTML = `
            <div class="bg-red-900 border border-red-500 rounded p-4">
              <h3 class="text-xl font-bold text-red-300 mb-2">‚ùå Network Error</h3>
              <p class="text-red-200">${error.message}</p>
            </div>
          `;
        }
      });

